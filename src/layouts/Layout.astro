---
// Import main CSS for styling
import '../index.css';
import '../styles/integrations-animations.css';
import '../styles/image-performance.css';
import ScailUpHeader from '../components/active/shared/ScailUpHeader';
import TrackingScript from '../components/TrackingScript.astro';
import Analytics from '../components/Analytics.astro';
import { ViewTransitions } from 'astro:transitions';
import { getImage } from 'astro:assets';
import heroImage from '../../public/hero-bg-buildrs-8k.webp';
import platformDashboard from '../../public/platform-dashboard-fullwidth.webp';

export interface Props {
  title: string;
  description?: string;
  keywords?: string;
  structuredData?: object;
}

const { title, description, keywords, structuredData } = Astro.props;

// Generate optimized image URLs for preloading
const optimizedHero = await getImage({ src: heroImage, format: 'webp', quality: 90, width: 1920 });
const optimizedPlatform = await getImage({ src: platformDashboard, format: 'webp', quality: 90, width: 1920 });
---

<!DOCTYPE html>
<html lang="nl" style="margin: 0 !important; padding: 0 !important; height: 100% !important; background-color: #000000 !important; overflow-x: hidden !important;">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- CRITICAL: NUCLEAR BLACK BACKGROUND - ZERO TOLERANCE FOR WHITE -->
  <style>
    /* INSTANT BLACK - HIGHEST PRIORITY */
    :root {
      background: #000000 !important;
      background-color: #000000 !important;
    }
    
    html {
      background: #000000 !important;
      background-color: #000000 !important;
      margin: 0 !important;
      padding: 0 !important;
      height: 100% !important;
      overflow-x: hidden !important;
      /* Browser default overrides */
      -webkit-background-color: #000000 !important;
      -moz-background-color: #000000 !important;
    }
    
    html::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: #000000 !important;
      z-index: -9999;
      pointer-events: none;
    }
    
    body {
      background: #000000 !important;
      background-color: #000000 !important;
      margin: 0 !important;
      padding: 0 !important;
      min-height: 100vh !important;
      color: #ffffff !important;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', system-ui, sans-serif !important;
      opacity: 1 !important;
      overflow-x: hidden !important;
      /* Browser default overrides */
      -webkit-background-color: #000000 !important;
      -moz-background-color: #000000 !important;
    }
    
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: #000000 !important;
      z-index: -9998;
      pointer-events: none;
    }
    
    /* FORCE BLACK ON EVERYTHING */
    * {
      box-sizing: border-box;
    }
    
    *:not(img):not(video):not(iframe):not(svg):not(canvas) {
      background-color: inherit !important;
    }
    
    /* Viewport meta override */
    html, body, #__next, #root, main, .app, [data-astro-root] {
      background: #000000 !important;
      background-color: #000000 !important;
      min-height: 100vh !important;
    }
    
    /* Browser chrome override */
    @media screen {
      html {
        background: #000000 !important;
      }
    }
    
    /* MODERN NATIVE VIEW TRANSITIONS - Zero JavaScript */
    @view-transition {
      navigation: auto;
    }
    
    /* View transition root animations - always black */
    ::view-transition-old(root),
    ::view-transition-new(root) {
      background-color: #000000 !important;
      mix-blend-mode: normal;
    }
    
    /* Smooth fade transitions */
    ::view-transition-old(root) {
      animation: fade-out 300ms cubic-bezier(0.16, 1, 0.3, 1);
    }
    
    ::view-transition-new(root) {
      animation: fade-in 300ms cubic-bezier(0.16, 1, 0.3, 1);
    }
    
    /* Ensure transition container is black */
    ::view-transition-group(root) {
      background-color: #000000 !important;
    }
    
    @keyframes fade-out {
      from {
        opacity: 1;
        background-color: #000000;
      }
      to {
        opacity: 0;
        background-color: #000000;
      }
    }
    
    @keyframes fade-in {
      from {
        opacity: 0;
        background-color: #000000;
      }
      to {
        opacity: 1;
        background-color: #000000;
      }
    }
    
    /* SMOOTH ELEMENT TRANSITIONS */
    /* Header persistence - no animation to avoid jank */
    ::view-transition-group(main-header) {
      animation-duration: 0ms;
    }
    
    ::view-transition-old(main-header),
    ::view-transition-new(main-header) {
      animation: none;
    }
    
    /* Main content smooth morph */
    ::view-transition-old(main-content) {
      animation: slide-out-left 300ms cubic-bezier(0.16, 1, 0.3, 1);
    }
    
    ::view-transition-new(main-content) {
      animation: slide-in-right 300ms cubic-bezier(0.16, 1, 0.3, 1);
    }
    
    @keyframes slide-out-left {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(-20px);
        opacity: 0;
      }
    }
    
    @keyframes slide-in-right {
      from {
        transform: translateX(20px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
  </style>
  
  <!-- ESSENTIAL: Only critical assets that should always load -->
  <link rel="preload" href={optimizedPlatform.src} as="image" fetchpriority="high" />
  
  <!-- Dynamic preloading handles section-specific images based on scroll position -->
  
  <!-- CRITICAL: Preload ALL fonts immediately -->
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"></noscript>
  
  <!-- Preload critical font files directly -->
  <link rel="preload" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZ9hiA.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuDyfAZ9hiA.woff2" as="font" type="font/woff2" crossorigin>
  
  <!-- AGGRESSIVE: Preconnect to all external domains immediately -->
  <link rel="preconnect" href="https://cdn.simpleicons.org" crossorigin />
  <link rel="preconnect" href="https://logo.clearbit.com" crossorigin />
  <link rel="preconnect" href="https://res.cloudinary.com" crossorigin />
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  
  <!-- Prefetch critical JavaScript modules -->
  <link rel="modulepreload" href="/src/components/active/agency/HomeHero.tsx" />
  <link rel="modulepreload" href="/src/components/active/agency/SalesEngineSection.tsx" />
  <link rel="modulepreload" href="/src/components/active/agency/MarketingEngineSection.tsx" />
  

  
  <!-- ULTRA-SMOOTH: Layout stability and refresh optimization -->
  <style>
    html, body {
      background-color: #000000 !important;
      margin: 0 !important;
      padding: 0 !important;
      min-height: 100vh !important;
      
      /* Modern layout stability */
      overflow-anchor: none !important;
      scroll-behavior: smooth; /* Smooth scrolling for better UX */
    }
    
    /* Visual stability during refresh and navigation */
    html {
      contain: layout style;
      transform: translateZ(0); /* Hardware acceleration */
    }
    
    /* Prevent layout shifts */
    * {
      box-sizing: border-box;
    }
    
    /* Image stability - prevent CLS */
    img {
      max-width: 100%;
      height: auto;
      display: block;
      contain: layout;
    }
    
    /* Section stability with hardware acceleration */
    section {
      contain: layout style;
      will-change: auto;
      transform: translateZ(0);
    }
    
    /* Professional loading - content always visible */
    body {
      opacity: 1;
      background-color: #000000;
      contain: layout style;
      transform: translateZ(0);
    }
    
    /* Font loading stability */
    @media (prefers-reduced-motion: no-preference) {
      html {
        font-display: swap;
      }
    }
    
    /* Reduced motion compliance */
    @media (prefers-reduced-motion: reduce) {
      html {
        scroll-behavior: auto !important;
      }
      
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
    
    /* Smooth page transitions preparation */
    body {
      transition: none;
    }
    
    /* Enhanced hardware acceleration and paint optimization */
    html, body, main {
      transform: translateZ(0);
      backface-visibility: hidden;
      perspective: 1000px;
    }
    
    /* Optimize rendering layers */
    header, nav, section, footer {
      will-change: auto;
      transform: translateZ(0);
    }
    
    /* Prevent paint flashing during transitions */
    * {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* Optimize scroll performance */
    body {
      scroll-behavior: smooth;
      overscroll-behavior: none;
    }
    
    /* Navigation optimization without view transitions */
    .page-loading {
      background-color: #000000 !important;
      opacity: 1;
    }
    
    /* Instant black for React hydration */
    [data-astro-cid-j7pv25f6], [astro-island] {
      background-color: #000000 !important;
    }
    
    /* Anti-flash utility classes */
    .no-flash {
      background-color: #000000 !important;
      transition: none !important;
    }
    
    .instant-black {
      background: #000000 !important;
      background-color: #000000 !important;
    }
  </style>
  
  <!-- Favicon -->
  <link rel="icon" href="/favicon.svg" type="image/svg+xml" sizes="any">

  <!-- SEO Meta Tags -->
  <title>{title}</title>
  {description && <meta name="description" content={description} />}
  {keywords && <meta name="keywords" content={keywords} />}

  <!-- Performance & Caching Optimizations -->
  <meta http-equiv="Cache-Control" content="public, max-age=31536000, immutable" />
  <meta http-equiv="Permissions-Policy" content="accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=()" />
  <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
  
  <!-- Resource Hints for Better Performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
  <link rel="dns-prefetch" href="https://res.cloudinary.com" />
  <link rel="dns-prefetch" href="https://api.supabase.io" />
  <!-- Preconnect for external logo CDNs used in IntegrationsShowcase -->
  <link rel="preconnect" href="https://cdn.simpleicons.org" crossorigin />
  <link rel="preconnect" href="https://logo.clearbit.com" crossorigin />
  
  <!-- Aggressive prefetch likely next routes for instant navigation -->
  <link rel="prefetch" href="/contact/" />
  <link rel="prefetch" href="/contact" />
  <link rel="prefetch" href="/marketingbureaus" />
  
  <!-- Prefetch critical React components for marketingbureaus page -->
  <link rel="modulepreload" href="/src/components/active/usecase/MarketingBureauHero.tsx" />
  <link rel="modulepreload" href="/src/components/active/usecase/MarketingBureauServicesSection.tsx" />
  <link rel="modulepreload" href="/src/components/active/usecase/MarketingBureauFinalCTA.tsx" />
  
  <!-- Prefetch critical assets that might be needed -->
  <link rel="prefetch" href="/platform-dashboard-fullwidth.webp" />
  <link rel="prefetch" href="/sales-engine-dashboard.webp" />
  <link rel="prefetch" href="/marketing-engine-dashboard.webp" />
  
  <!-- Critical CSS will be inlined by Astro build process -->
  <link rel="modulepreload" href="/src/index.css" />

  <!-- Content Security Policy -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://static.hsappstatic.net https://plausible.io; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: https:; media-src 'self' https://res.cloudinary.com; font-src 'self' data: https://fonts.googleapis.com https://fonts.gstatic.com; connect-src 'self' https: https://plausible.io; frame-src 'self' https://meetings-eu1.hubspot.com; object-src 'none'; base-uri 'self';" />

  <!-- Preconnect to external domains -->
  <link rel="preconnect" href="https://res.cloudinary.com" />
  <link rel="preconnect" href="https://plausible.io" crossorigin />

  <!-- Canonical URL -->
  <link rel="canonical" href={`https://buildrs.ai${Astro.url.pathname}`} />

  <!-- Open Graph -->
  <meta property="og:title" content={title} />
  {description && <meta property="og:description" content={description} />}
  <meta property="og:type" content="website" />
  <meta property="og:url" content={`https://buildrs.ai${Astro.url.pathname}`} />
  <meta property="og:image" content="https://buildrs.ai/hero-bg-buildrs-8k.webp" />
  <meta property="og:site_name" content="Buildrs" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content={title} />
  {description && <meta name="twitter:description" content={description} />}
  <meta name="twitter:image" content="https://buildrs.ai/hero-bg-buildrs-8k.webp" />
  <meta name="twitter:site" content="@buildrs" />

  <!-- Structured Data -->
  {structuredData && <script type="application/ld+json" set:html={JSON.stringify(structuredData)}></script>}

  <!-- Plausible Analytics - Privacy-First Analytics -->
  <Analytics />

  <!-- Modern View Transitions with theme persistence -->
  <ViewTransitions />

  <!-- Performance optimizations -->
  <link rel="dns-prefetch" href="//fonts.googleapis.com" />

  <!-- CRITICAL: Instant visibility - no FOUC -->
  <style>
    /* Essential instant paint - no delays, no opacity transitions */
    html, body {
      margin: 0;
      padding: 0;
      background-color: #000000;
      color: #ffffff;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', system-ui, sans-serif;
      font-feature-settings: 'cv05' 1, 'kern' 1;
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
    }
    
    /* Essential box model */
    *, *::before, *::after {
      box-sizing: border-box;
    }
    
    /* Main container - always black background with GPU acceleration */
    main {
      background-color: #000000;
      min-height: 100vh;
      transform: translateZ(0);
      will-change: auto;
    }
    
    /* Instant hero background visibility */
    section[class*="hero"] {
      background-color: #000000;
      min-height: 100vh;
    }
  </style>

  <!-- Glitch animations voor HomeAnimatedHeadline -->
  <style>
    .glitch-rgb-red { animation: glitch-rgb-red 120ms linear infinite; }
    .glitch-rgb-green { animation: glitch-rgb-green 120ms linear infinite; }
    .glitch-rgb-blue { animation: glitch-rgb-blue 120ms linear infinite; }
    .glitch-slice-1 { animation: glitch-slice-1 120ms linear infinite; }
    .glitch-slice-2 { animation: glitch-slice-2 120ms linear infinite; }
    .glitch-scanline { animation: glitch-scanline 120ms linear infinite; }

    @keyframes glitch-rgb-red {
      0% { transform: translate(-2px, -1px) skewX(-1deg); opacity: 0.8; }
      25% { transform: translate(1px, 2px) skewX(1deg); opacity: 0.9; }
      50% { transform: translate(-1px, 1px) skewX(-0.5deg); opacity: 0.7; }
      75% { transform: translate(2px, -2px) skewX(1.5deg); opacity: 0.8; }
      100% { transform: translate(-1px, 1px) skewX(0.5deg); opacity: 0.9; }
    }

    @keyframes glitch-rgb-green {
      0% { transform: translate(1px, -2px) skewY(1deg); opacity: 0.7; }
      25% { transform: translate(-2px, 1px) skewY(-1deg); opacity: 0.8; }
      50% { transform: translate(2px, 1px) skewY(0.5deg); opacity: 0.6; }
      75% { transform: translate(-1px, -2px) skewY(-1.5deg); opacity: 0.9; }
      100% { transform: translate(1px, 2px) skewY(1deg); opacity: 0.7; }
    }

    @keyframes glitch-rgb-blue {
      0% { transform: translate(2px, 1px) skewX(0.5deg); opacity: 0.9; }
      30% { transform: translate(-1px, -2px) skewX(-1deg); opacity: 0.6; }
      60% { transform: translate(3px, 1px) skewX(1.5deg); opacity: 0.8; }
      90% { transform: translate(-2px, -1px) skewX(-0.5deg); opacity: 0.7; }
      100% { transform: translate(1px, 2px) skewX(1deg); opacity: 0.8; }
    }

    @keyframes glitch-slice-1 {
      0% { transform: translateX(0px); }
      10% { transform: translateX(-5px) scaleX(1.05); }
      20% { transform: translateX(3px) scaleX(0.95); }
      30% { transform: translateX(-2px) scaleX(1.02); }
      40% { transform: translateX(4px) scaleX(0.98); }
      50% { transform: translateX(-3px) scaleX(1.03); }
      60% { transform: translateX(2px) scaleX(0.97); }
      70% { transform: translateX(-4px) scaleX(1.01); }
      80% { transform: translateX(3px) scaleX(0.99); }
      90% { transform: translateX(-1px) scaleX(1.02); }
      100% { transform: translateX(0px) scaleX(1); }
    }

    @keyframes glitch-slice-2 {
      0% { transform: translateX(0px); }
      15% { transform: translateX(4px) scaleX(0.96); }
      30% { transform: translateX(-3px) scaleX(1.04); }
      45% { transform: translateX(2px) scaleX(0.98); }
      60% { transform: translateX(-4px) scaleX(1.02); }
      75% { transform: translateX(3px) scaleX(0.97); }
      90% { transform: translateX(-1px) scaleX(1.01); }
      100% { transform: translateX(0px) scaleX(1); }
    }

    @keyframes glitch-scanline {
      0% { top: 0%; height: 2px; opacity: 0.8; }
      25% { top: 25%; height: 1px; opacity: 1; }
      50% { top: 50%; height: 3px; opacity: 0.6; }
      75% { top: 75%; height: 1px; opacity: 0.9; }
      100% { top: 100%; height: 2px; opacity: 0.7; }
    }
  </style>
</head>
<body class="min-h-screen bg-black text-white" style="margin: 0 !important; padding: 0 !important; height: 100% !important; position: relative !important; top: 0 !important; background-color: #000000 !important;">
  <!-- MODERN ASTRO VIEW TRANSITIONS - PERFECT THEME PERSISTENCE -->
  <script>
    // Modern Astro View Transitions Best Practice
    function ensureBlackTheme() {
      // Force black background immediately - before any paint
      const style = {
        backgroundColor: '#000000 !important',
        background: '#000000 !important',
        color: '#ffffff !important'
      };
      
      // Apply to document elements
      if (document.documentElement) {
        Object.assign(document.documentElement.style, style);
        document.documentElement.setAttribute('data-theme', 'dark');
      }
      if (document.body) {
        Object.assign(document.body.style, style);
        document.body.setAttribute('data-theme', 'dark');
      }
      
      // Ensure main content is black
      const main = document.querySelector('main');
      if (main) {
        main.style.backgroundColor = '#000000 !important';
      }
    }
    
    // Execute immediately for first page load
    ensureBlackTheme();
    
    // CRITICAL: Astro View Transitions lifecycle events
    document.addEventListener('astro:after-swap', () => {
      // This runs after new page content is swapped in but before paint
      ensureBlackTheme();
      
      // Re-initialize any scripts that need to run on new page
      console.log('Page transition complete - theme preserved');
    });
    
    document.addEventListener('astro:before-swap', () => {
      // Ensure black background is maintained during transition
      ensureBlackTheme();
    });
    
    document.addEventListener('astro:page-load', () => {
      // Ensure theme consistency on any page load
      ensureBlackTheme();
    });
    
    // Fallback for older browsers or direct navigation
    window.addEventListener('pageshow', ensureBlackTheme);
    window.addEventListener('DOMContentLoaded', ensureBlackTheme);
  </script>
  
  <!-- ScailUp Navigation Header -->
  <ScailUpHeader client:load showAlways={true} />
  
  <slot />
  
  <!-- UTM Tracking Script - No cookies, localStorage only -->
  <TrackingScript />

</body>
</html>
